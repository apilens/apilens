---
title: "Building an SDK"
description: "Guidance for API Lens SDK architecture, official SDKs, and ingest/client implementation standards."
---

## SDK Goal

An API Lens SDK should make telemetry ingest reliable by default:

- capture request lifecycle data
- normalize request records consistently
- batch and flush safely
- retry transient failures
- fail open (do not break the host API)

## Official SDKs

API Lens currently ships two official SDKs in this repository:

| SDK | Package | Integrations |
|---|---|---|
| Python | `apilenss` | FastAPI, Flask, Django/Django Ninja |
| JavaScript | `apilens-js-sdk` | Express, Next.js App Router |

Setup guides:

- Python: `/sdk/python-setup`
- JavaScript: `/sdk/javascript-setup`

## Ingest Baseline

SDKs send batches to:

- `POST /ingest/requests`

Required headers:

- `Content-Type: application/json`
- `X-API-Key: <app_api_key>`

Payload shape:

```json
{
  "requests": [
    {
      "timestamp": "2026-02-13T12:00:00Z",
      "environment": "production",
      "method": "GET",
      "path": "/v1/orders",
      "status_code": 200,
      "response_time_ms": 120,
      "request_size": 245,
      "response_size": 1402,
      "ip_address": "203.0.113.10",
      "user_agent": "web-checkout",
      "consumer_id": "",
      "consumer_name": "",
      "consumer_group": "",
      "request_payload": "",
      "response_payload": ""
    }
  ]
}
```

## Normalization Rules

Apply consistent normalization before enqueue:

- uppercase HTTP method
- normalized route path (without host; query removed)
- response time in milliseconds
- valid ISO timestamp
- non-negative sizes and status code
- explicit environment value

## Reliability Expectations

Recommended defaults:

- batch size: `100-500`
- flush interval: `2-5s`
- retries: `3` with exponential backoff
- bounded queue with oldest-drop policy under pressure

Runtime behavior:

- never throw into user handler for ingest failures
- log ingest errors in SDK logger
- flush on graceful shutdown where runtime allows

## Consumer Tracking

SDKs should expose lightweight helpers to attach request identity:

- `consumer_id`
- `consumer_name`
- `consumer_group`

This enables API Lens consumer filtering and breakdowns in dashboard analytics.

## Testing Standards

Each SDK should include:

- unit tests for normalization and config resolution
- unit tests for retry and queue behavior
- framework integration tests for middleware/wrapper behavior
- regression tests for edge cases (error paths, payload truncation, disabled mode)
- e2e check against a running local API Lens environment

## Versioning Advice

- hide wire schema behind typed SDK interfaces
- keep transport and framework adapters decoupled
- document behavior changes in SDK changelog per release
- preserve backward compatibility for public helper names where possible
